@model VoteEvaluationViewModel
@{
    ViewData["Title"] = "Evaluate: " + Model.VoteTitle;
    int alternativeId = -1;
}

<h2>Evaluate: @Model.VoteTitle</h2>
@if (!string.IsNullOrEmpty(Model.Description))
{
    <div class="vote-description mb-4">
        <p class="lead">@Model.Description</p>
    </div>
}
<form asp-action="Evaluate">
    <input type="hidden" asp-for="VoteId" />
    <input type="hidden" asp-for="IsPrivate" />
    <input type="hidden" asp-for="VoteTitle" />
    @for (int i = 0; i < Model.Criteria.Count; i++)
    {
        var isNew = Model.Alternatives.Count() > 0 && alternativeId != Model.Criteria[i].DBVoteAlternativeId && Model.Criteria[i].DBVoteAlternativeId != null;
        alternativeId = isNew ? Model.Criteria[i].DBVoteAlternativeId : alternativeId;
        var alternative = isNew ? Model.Alternatives.Where((item) => item.Id == Model.Criteria[i].DBVoteAlternativeId).First() : null;
        <h3>@alternative?.Title</h3>
        <div class="criteria-item border p-3 mb-3">
            <input type="hidden" asp-for="Criteria[i].SettingsId" />
            <input type="hidden" asp-for="Criteria[i].MinValue" />
            <input type="hidden" asp-for="Criteria[i].MaxValue" />
            <input type="hidden" asp-for="Criteria[i].DBVoteAlternativeId" />
            <input type="hidden" asp-for="Criteria[i].Title" />
            <input type="hidden" asp-for="Criteria[i].Description" />
            <input type="hidden" asp-for="Criteria[i].ImportanceValue" />
            <h4>@Model.Criteria[i].Title</h4>
            <p>@Model.Criteria[i].Description</p>

            <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                        <label asp-for="Criteria[i].Value" class="control-label"></label>
                        <input type="number" asp-for="Criteria[i].Value" class="form-control"
                               min="@Model.Criteria[i].MinValue" max="@Model.Criteria[i].MaxValue" step="@Model.Criteria[i].StepValue" />
                        <small class="form-text text-muted">
                            Value (@Model.Criteria[i].MinValue - @Model.Criteria[i].MaxValue)
                        </small>
                        <span asp-validation-for="Criteria[i].Value" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>
    }
    <div class="form-group">
        <input type="submit" value="Submit Evaluation" class="btn btn-primary" />
        <a asp-action="Index" class="btn btn-secondary">Cancel</a>
    </div>
</form>